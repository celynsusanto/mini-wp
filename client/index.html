<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>Mini Wordpress</title>

        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
        <link rel="stylesheet" href="main.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
        <link rel="stylesheet" href="./wygiwys.css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.1/css/mdb.min.css" rel="stylesheet">

    </head>
    <script src="./wysiwyg.js"></script>

    <body >
        <div class="row">
            <div class="col-12 header aqua-gradient z-depth-1">
                <nav class="navbar navbar-dark ">
                    <i id="sidebarCollapse" style="color:black;cursor: pointer;" class="fas fa-ellipsis-h fa-2x hover-nav" ></i>                    
                    <i style="color:black;cursor: pointer;" class="fas fa-home fa-2x hover-nav"></i>
                </nav>
            </div>
        </div>
        
        <div class="wrapper" >
            <div id="sidebar" style="border: 2px solid rgba(63, 81, 181, 0.1)" class="z-depth-4 scroll">
                <div class="row d-flex justify-content-center">
                    <div class="col-12">
                        <br>
                    </div>
                    <ul>
                        <ul >
                            <li >
                                <h6 class="waves-effect d-flex"  style="cursor:pointer;border-radius:15px">
                                    <i class="fas fa-desktop ali align-self-start col-3 justify-content-start" ></i>         
                                    <span class="sv-normal col-9">View Site</span>
                                </h6>
                            </li>
                            <hr>
                            <li >
                                <h6 class="waves-effect d-flex" onclick="showArticles()" style="cursor:pointer;border-radius:15px">
                                    <i class="far fa-file-alt align-self-start col-3 justify-content-start"></i>
                                    <span class="sv-normal col-9">Articles</span>
                                </h6>
                            </li>
                            <hr>
                            <li >
                                <h6 class="waves-effect d-flex" onclick="addArticle()" style="cursor:pointer;border-radius:15px">
                                    <i class="fas fa-pen align-self-start col-3 justify-content-starts"></i>                                    
                                    <span class="sv-normal col-9">Write New Article</span>
                                </h6>
                            </li>
                            <hr>
                        </ul>
                    </ul>  
                </div>
            </div>
            <div id="app" class="content d-flex justify-content-center scroll" style="width:100%; color:white">
                <div id="articles" style="width:90%;" >

                    <div class="col-12 scroll z-depth-4" style="color:black;width:100%">
                        <hr>
                        <div class="input-group md-form form-sm form-2 pl-0 z-depth-1" style="border-radius: 10px">
                            <input v-model="search" class="form-control my-0 py-1 " type="text" placeholder="Search" aria-label="Search" >
                            <div class="input-group-append ">
                                <span class="input-group-text blue-gradient " id="basic-text1" style="cursor: pointer"><i class="fas fa-search" aria-hidden="true"></i></span>
                            </div>
                        </div>

                        <hr>
                        <div v-for="index in filterArticle">
                            <div class="card text-center align-self-center blue-gradient z-depth-2" style="height:95%;border-radius: 15px;color:white">

                                <div  class="card-body" >
                                    <h6 class="card-title">{{index.title}}</h6>
                                    <h7>{{index.content}}</h7>
                                    <i class="far fa-edit right" style="cursor:pointer" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"></i>
                                    <i v-on:click.prevent="deleteArticle(index._id)" class="far fa-trash-alt" style="cursor:pointer;" style=""></i>
                                </div>

                                <div class="collapse" id="collapseExample">
                                    <div class="card card-body">
                                        Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident.
                                    </div>
                                </div>
                                                                
                            </div>
                        <hr>
                        </div>

                    </div>
                </div>  

                <div id="addArticle" class="card text-center align-self-center" style="height:95%;width: 80%;">
                    <div class="card-header  blue-gradient z-depth-4 z-depth-2"   >
                        Add an Article 
                    </div>
                    <div  class="card-body z-depth-2" style="color:black; background-color: white">
                        <form v-on:submit.prevent="addArticle">
                            <div class="md-form ">
                                    <input v-model="title" type="text" class="form-control z-depth-1" name="title" style="border-radius: 10px;">
                                    <label for="form106">Title</label>
                                </div>
                                <div class="z-depth-1" style="border-radius: 15px;" >
                                    <wysiwyg v-model="text" />
                                </div>
                                <div class="text-center">
                                <hr>
                                <button type="submit" class="btn blue-gradient z-depth-1a" style="border-radius: 15px;">Add New Article</button>
                            </div>
                        </form>

                    </div>
                </div>
                                                
            </div>
        </div>         

        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.1/js/mdb.min.js"></script>
        <script >
            $("#articles").hide()
            $("#addArticle").hide()

            $(document).ready(function () {
                $('#sidebarCollapse').on('click', function () {
                    $('#sidebar').toggleClass('active');
                });
            });

            function showArticles() {
                $("#articles").show()
                $("#addArticle").hide()
                $("#viewSite").hide()
            }

            function addArticle() {
                $("#articles").hide()
                $("#addArticle").show()
                $("#viewSite").hide()               
            }

            function viewSite() {
                
            }

            const app = new Vue({
                el: '#app',
                components: {
                    wysiwyg: vueWysiwyg.default.component,
                },
                data() {
                    return {
                        title: "",
                        text: '',
                        search: "",
                        articles: []
                    };
                }, 
                beforeCreate:  function() {
                    axios
                        .get('http://localhost:3000/articles')
                        .then(({data}) => {
                            console.log(data)
                            this.articles = data
                        })
                        .catch((err) => {
                            console.log(err)
                        }) 
                },
                computed: {
                    filterArticle: function() {
                        let self = this
                        let theArticle =  this.articles.filter(function(article){
                            if (article.title.toLowerCase().indexOf(self.search.toLowerCase()) >= 0) {
                                return article
                            }
                        })
                        return theArticle
                    }
                }, 
                methods: {
                    addArticle: function() {
                        axios
                            .post("http://localhost:3000/articles",{title: this.title, content: this.text})
                            .then((response) => {
                                this.articles.push({title: response.data.createdArticle.title, content: response.data.createdArticle.content})
                                showArticles()
                                this.title = "",
                                this.text = "",
                                swal(response.data.status, "", "success")
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    },
                    deleteArticle: function(id) {
                        axios
                            .delete(`http://localhost:3000/articles/` + id)
                            .then((response) => {
                                console.log(response)
                                this.articles = response.data.articles
                                showArticles()
                                swal(response.data.status, "", "success")
                            })
                            .catch((err) => {
                                console.log(err)
                            })
                    }
                    
                }


            }) 

        </script>

    </body>

</html>